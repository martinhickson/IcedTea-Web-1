-----------
IDE Setup
-----------
Run "sh setup-project.sh" to download the jars required for compilation to your local cache.
Add the external jars in ~/.cache/itw-coding/ to your IDE's classpath
Add netx as the only source folder
Use JDK 1.8 as the compilation source and target version

--------------------------------------------------------------
Cygwin Build Steps on Windows for IcedTea-Web MSI Installer:
--------------------------------------------------------------

Install Chocolatey Software Automation tool from website: https://chocolatey.org/

#Install build tools:
choco feature enable -n allowGlobalConfirmation
choco install cygwin git cyg-get wixtoolset corretto8jdk rust maven
cyg-get git autoconf automake libtool pkg-config m4 zip make unzip

Use Windows Explorer to manually copy C:\Program Files\Amazon Corretto\jdk1.8.0_392 to C:\tools\cygwin\lib\jvm\openjdk
(or in Cygwin bash use: mkdir -p /cygdrive/c/tools/cygwin/lib/jvm/ && \
cp -r /cygdrive/c/Program\ Files/Amazon\ Corretto/jdk1.8.0_* /cygdrive/c/tools/cygwin/lib/jvm/openjdk)
(On Linux, backup /usr/lib/jvm/openjdk first if it exists, then copy it to /usr/lib/jvm/openjdk)

#Obtain required 3rd party components:
#Note that the build requires filenames without hyphens or numeric characters
#Further note that the -L option is required to follow redirects in bash, but should be omitted for Powershell, which
#follows redirects by default.
cd /usr/bin
curl -L -o wixgen.jar https://github.com/akashche/wixgen/releases/download/1.7/wixgen.jar
mkdir -p /usr/share/java
cd /usr/share/java
curl -o tagsoup.jar https://repo1.maven.org/maven2/org/ccil/cowan/tagsoup/tagsoup/1.2.1/tagsoup-1.2.1.jar
curl -o mslinks.jar https://repo1.maven.org/maven2/com/github/vatbub/mslinks/0.0.2/mslinks-0.0.2.jar  git clone git@github.com:martinhickson/IcedTea-Web-1.git
curl -o rhino.jar https://repo1.maven.org/maven2/org/mozilla/rhino/1.7.14/rhino-1.7.14.jar
curl -o commonscompress.jar https://repo1.maven.org/maven2/org/apache/commons/commons-compress/1.26.0/commons-compress-1.26.0.jar
curl -L -o pack.jar https://github.com/martinhickson/pack200/releases/download/pack200-11.0.3/pack.jar

#Edit the Git URL to clone as appropriate
mkdir ~/work && cd ~/work && git clone https://github.com/martinhickson/IcedTea-Web-1.git
cd IcedTea-Web-1/
git checkout 1.8   #1.8 branch, alternatively checkout a specific tag
make clean
#(if it isn't cleaning properly then run: "git reset --hard && git clean -d -f && git status" [backup any files
#  that you want to keep first])
autoreconf -i    #N.B. if you need to edit the version number, then edit configure.ac, and rerun this command
export PATH=/usr/lib/jvm/openjdk/bin/:$PATH && cp html-gen.sh html-gen-windows-line-endings.sh

#Convert DOS line-endings to Unix
sed -i 's/\r$//' html-gen.sh

#Duplicate the wix folder in C:\Program Files (x86) and rename it to "wix"
#(as version numbers may vary and the path is important for the following command)

#Note && is used to join commands so if one build command fails then it exits
./configure --disable-native-plugin --with-wix=C:/PROGRA~2/wix/bin \
--with-jre-home=C:/tools/cygwin/lib/jvm/openjdk/jre \
--with-jdk-home=C:/tools/cygwin/lib/jvm/openjdk \
--with-tagsoup=C:/tools/cygwin/usr/share/java/tagsoup.jar \
--with-commonscompress=C:/tools/cygwin/usr/share/java/commonscompress.jar \
--with-pack=C:/tools/cygwin/usr/share/java/pack.jar \
--with-wixgen=/usr/bin/wixgen.jar --with-rhino=C:/tools/cygwin/usr/share/java/rhino.jar \
--with-mslinks=C:/tools/cygwin/usr/share/java/mslinks.jar \
&& make && make install && make win-installer

#(if the configure command above fails because it cannot find rust, then install it again via: choco install rust)

You will find the MSI in the folder win-installer.build, e.g. ~/work/IcedTeaWeb-1/win-installer.build/icedtea-web-1.8.8.5.msi

-------------------------------
Oracle Linux 9.2 Build Steps:
-------------------------------

sudo yum -y groupinstall "Development tools"
sudo yum -y install pkgconfig rust cargo java-1.8.0-openjdk java-1.8.0-openjdk-devel
#N.B. Ignore the error about rust already being installed:
curl https://sh.rustup.rs -sSf | bash -s -- -y
export PATH="~/.cargo/bin:${PATH}"
#N.B. || (OR) is used here so it will cd even if work already exists
mkdir ~/work || cd ~/work
git clone https://github.com/martinhickson/IcedTea-Web-1.git
cd IcedTea-Web-1 && git checkout 1.8
sed -i 's/PKG_CHECK_VAR/#PKG_CHECK_VAR/' configure.ac
sed -i 's/bashcompdir=/bashcompdir="${sysconfdir}\/bash_completion.d" #bashcompdir=/' configure.ac
sudo update-alternatives --config java   #manually select JDK version 1.8
sudo update-alternatives --config javac  #manually select JDK version 1.8
cd /usr/share/java
#Obtain required 3rd party components:
#Note that the build requires filenames without hyphens or numeric characters
#Further note that the -L option is required to follow redirects in bash, but should be omitted for Powershell, which
#follows redirects by default.
#N.B. the following line is only required if tagsoup isn't already present:
sudo curl -o tagsoup.jar https://repo1.maven.org/maven2/org/ccil/cowan/tagsoup/tagsoup/1.2.1/tagsoup-1.2.1.jar
sudo curl -o rhino.jar https://repo1.maven.org/maven2/org/mozilla/rhino/1.7.14/rhino-1.7.14.jar
sudo curl -o commonscompress.jar https://repo1.maven.org/maven2/org/apache/commons/commons-compress/1.26.0/commons-compress-1.26.0.jar
sudo curl -L -o pack.jar https://github.com/martinhickson/pack200/releases/download/pack200-11.0.3/pack.jar
cd ~/work/IcedTea-Web-1
autoreconf -i && ./configure --prefix=/usr/local --disable-native-plugin --with-itw-libs=DISTRIBUTION
make
make install DESTDIR=zip/tmp
mkdir -p zip/tmp/usr/share/java
cd zip/tmp/usr/share/java
sudo curl -o tagsoup.jar https://repo1.maven.org/maven2/org/ccil/cowan/tagsoup/tagsoup/1.2.1/tagsoup-1.2.1.jar
sudo curl -o rhino.jar https://repo1.maven.org/maven2/org/mozilla/rhino/1.7.14/rhino-1.7.14.jar
sudo curl -o commonscompress.jar https://repo1.maven.org/maven2/org/apache/commons/commons-compress/1.26.0/commons-compress-1.26.0.jar
sudo curl -L -o pack.jar https://github.com/martinhickson/pack200/releases/download/pack200-11.0.3/pack.jar
cd ../../..
zip -r icedtea-web-1.8.8.12.linux.bin.zip .

#N.B. to install the package, use the following commands:
unzip -d / icedtea-web-1.8.8.12.linux.bin.zip

-------------------------------
Linux CentOS 7.6 Build Steps:
-------------------------------

sudo yum -y groupinstall "Development tools"
sudo yum -y install pkgconfig rust cargo java-1.8.0-openjdk java-1.8.0-openjdk-devel
curl https://sh.rustup.rs -sSf | bash -s -- -y
export PATH="~/.cargo/bin:${PATH}"
#N.B. || (OR) is used here so it will cd even if work already exists
mkdir ~/work || cd ~/work
git clone https://github.com/martinhickson/IcedTea-Web-1.git
cd IcedTea-Web-1 && git checkout 1.8
sed -i 's/PKG_CHECK_VAR/#PKG_CHECK_VAR/' configure.ac
sed -i 's/bashcompdir=/bashcompdir="${sysconfdir}\/bash_completion.d" #bashcompdir=/' configure.ac
sudo update-alternatives --config java   #manually select JDK version 1.8
sudo update-alternatives --config javac  #manually select JDK version 1.8
autoreconf -i && ./configure  --prefix=/usr/local --disable-native-plugin --with-itw-libs=DISTRIBUTION
make
make install DESTDIR=zip/tmp
mkdir -p zip/tmp/usr/share/java
cd zip/tmp/usr/share/java
sudo curl -o tagsoup.jar https://repo1.maven.org/maven2/org/ccil/cowan/tagsoup/tagsoup/1.2.1/tagsoup-1.2.1.jar
sudo curl -o rhino.jar https://repo1.maven.org/maven2/org/mozilla/rhino/1.7.14/rhino-1.7.14.jar
sudo curl -o commonscompress.jar https://repo1.maven.org/maven2/org/apache/commons/commons-compress/1.26.0/commons-compress-1.26.0.jar
sudo curl -L -o pack.jar https://github.com/martinhickson/pack200/releases/download/pack200-11.0.3/pack.jar
cd ../../..
zip -r icedtea-web-1.8.8.12.linux.bin.zip .

#N.B. to install the package, use the following commands:
unzip -d / icedtea-web-1.8.8.12.linux.bin.zip

------------------------------------
Linux CentOS 7 Sample Dockerfile:
------------------------------------

Alternatively, the following Dockerfile can be used with Docker to create the Linux build (edit the proxy URL first):

FROM centos:7

ENV HTTP_PROXY "http://<host>:<port>"
ENV HTTPS_PROXY "http://<host>:<port>"

RUN echo "proxy=http:///<host>:<port>" >> /etc/yum.conf && \
    yum -y --setopt=tsflags=nodocs groupinstall "Development tools" && \
    yum -y --setopt=tsflags=nodocs install pkgconfig rust cargo java-1.8.0-openjdk java-1.8.0-openjdk-devel && \
    curl https://sh.rustup.rs -sSf | bash -s -- -y && \
    export PATH="/root/.cargo/bin:${PATH}" && \
    git clone https://github.com/martinhickson/IcedTea-Web-1.git && \
    cd IcedTea-Web-1 && \
    git checkout 1.8 && \
    sed -i 's/PKG_CHECK_VAR/#PKG_CHECK_VAR/' configure.ac && \
    sed -i 's/bashcompdir=/bashcompdir="${sysconfdir}\/bash_completion.d" #bashcompdir=/' configure.ac && \
    autoreconf -i && \
    ./configure --prefix=/usr/local --disable-native-plugin --with-itw-libs=DISTRIBUTION && \
    make && \
    make install DESTDIR=zip/tmp && \
    mkdir -p zip/tmp/usr/share/java && \
    cd zip/tmp/usr/share/java && \
    sudo curl -o tagsoup.jar https://repo1.maven.org/maven2/org/ccil/cowan/tagsoup/tagsoup/1.2.1/tagsoup-1.2.1.jar && \
    sudo curl -o rhino.jar https://repo1.maven.org/maven2/org/mozilla/rhino/1.7.14/rhino-1.7.14.jar && \
    sudo curl -o commonscompress.jar https://repo1.maven.org/maven2/org/apache/commons/commons-compress/1.26.0/commons-compress-1.26.0.jar && \
    sudo curl -L -o pack.jar https://github.com/martinhickson/pack200/releases/download/pack200-11.0.3/pack.jar && \
    cd ../../.. && \
    zip -r icedtea-web-1.8.8.12.linux.bin.zip .
    
Use the following commands to copy the built artifact out of the Docker image:

docker create --name icedtea-web icedtea-web:dockerfile
docker cp icedtea-web:/IcedTea-Web-1/zip/tmp/icedtea-web-1.8.8.12.linux.bin.zip .
